#!/bin/bash

cat names.list | parallel "echo Doing for file {} && capinfos {} -M >> {}.pcapinfo && tshark -r {} -Y \"udp\" -T fields -E occurrence=f -e ip.version -e ip.hdr_len -e ip.dsfield -e ip.tos.precedence -e ip.tos.delay -e ip.tos.throughput  -e ip.tos.reliability -e ip.tos.cost -e ip.dsfield.dscp -e ip.dsfield.ecn -e ip.len -e ip.id -e ip.flags.rb -e ip.flags.sf -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.fragment -e ip.fragment.count -e ip.ttl -e ip.proto -e ip.src -e ip.dst -e ip.src_rt -e ip.opt.flag -e ip.opt.type -e ip.opt.type.number -e ip.opt.type.class  -e udp.srcport -e udp.dstport -e tcp.seq -e tcp.ack -e tcp.flags.res -e tcp.flags.ns -e tcp.flags.cwr -e tcp.flags.ecn -e tcp.flags.urg  -e tcp.flags.ack -e tcp.hdr_len -e tcp.flags.push  -e tcp.flags.reset -e tcp.flags.syn  -e tcp.flags.fin -e tcp.window_size -e tcp.urgent_pointer -e tcp.option_len -e frame.len -e tcp.len -e frame.time_epoch -e eth.src -e eth.dst >> {}.csv && tshark -r {} -Y \"tcp\" -T fields -E occurrence=f -e ip.version -e ip.hdr_len -e ip.dsfield -e ip.tos.precedence -e ip.tos.delay -e ip.tos.throughput  -e ip.tos.reliability -e ip.tos.cost -e ip.dsfield.dscp -e ip.dsfield.ecn -e ip.len -e ip.id -e ip.flags.rb -e ip.flags.sf -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.fragment -e ip.fragment.count -e ip.ttl -e ip.proto -e ip.src -e ip.dst -e ip.src_rt -e ip.opt.flag -e ip.opt.type -e ip.opt.type.number -e ip.opt.type.class  -e tcp.srcport -e tcp.dstport -e tcp.seq -e tcp.ack -e tcp.flags.res -e tcp.flags.ns -e tcp.flags.cwr -e tcp.flags.ecn -e tcp.flags.urg  -e tcp.flags.ack -e tcp.hdr_len -e tcp.flags.push  -e tcp.flags.reset -e tcp.flags.syn  -e tcp.flags.fin -e tcp.window_size -e tcp.urgent_pointer -e tcp.option_len -e frame.len -e tcp.len -e frame.time_epoch -e eth.src -e eth.dst >> {}.csv"
